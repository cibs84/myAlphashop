<div class="container my-5">
  @if (viewModel$ | async; as vm) {
    <!-- *** SPINNER - LOADING *** -->
    <app-spinner
      [isVisible]="vm.showLoading">
    </app-spinner>

    <!-- Error 404 - Not Found Article -->
    @if (vm.errorVM && vm.errorVM.status === 404) {
      <app-status-info
        [title]="vm.errorVM.message"
        icon="fa-circle-exclamation"
        iconClass="text-danger"
        [showBackButton]="true"
        [showHomeButton]="true"
        (back)="goBack()">
      </app-status-info>
    }

    <!-- Article Detail -->
    @if (vm.article; as art) {
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Dettaglio Articolo: {{ art.description }}</h1>
      </div>
      <div class="row g-4">
        <div class="col-lg-8">
          <div class="card shadow-sm h-100">
            <div class="card-body">
              <div class="row mb-3">
                <div class="col-md-6">
                  <p class="mb-1"><strong class="text-primary">Codice Articolo:</strong> {{ art.codart }}</p>
                  <p class="mb-1"><strong>Descrizione Completa:</strong> {{ art.description }}</p>
                  @if (art.category) {
                    <p class="mb-1"><strong>Categoria:</strong> {{ art.category.id }} - {{ art.category.description }}</p>
                  }
                </div>
                <div class="col-md-6">
                  <p class="mb-1"><strong>Unit√† di Misura:</strong> {{ art.um }}</p>
                  <p class="mb-1"><strong>Codice Statistico:</strong> {{ art.codStat }}</p>
                  <p class="mb-1"><strong>Stato Articolo:</strong>
                  <span class="badge rounded-pill"
                                        [ngClass]="{
                                                    'bg-success': art.idArtStatus === 1,
                                                    'bg-warning text-dark': art.idArtStatus === 2,
                                                    'bg-danger': art.idArtStatus === 3
                                                  }">
                    {{ art.idArtStatus | literalItemStatus }}
                  </span>
                </p>
              </div>
            </div>
            <hr>
              <!-- Dati Commerciali -->
              <h5 class="card-title text-success mb-3">Dati Commerciali</h5>
              <div class="row">
                <div class="col-md-4">
                  <p class="mb-1"><strong>Prezzo (Netto):</strong> <span class="fs-4">{{ art.price | currency:'EUR' }}</span></p>
                </div>
                <div class="col-md-4">
                  <p class="mb-1"><strong>Peso Netto:</strong> {{ art.netWeight | number:'1.2-2' }} kg</p>
                  <p class="mb-1"><strong>Pezzi per Cartone:</strong> {{ art.pcsCart }}</p>
                </div>
                <div class="col-md-4">
                  @if (art.vat) {
                    <p class="mb-1"><strong>Aliquota IVA:</strong> {{ art.vat.idVat }}% ({{ art.vat.description }})</p>
                  }
                  <p class="mb-1"><strong>Data Creazione:</strong> {{ art.creationDate | date:'dd/MM/yyyy' }}</p>
                </div>
              </div>
              <hr>
                <!-- Barcodes -->
                <h5 class="card-title mt-4 mb-3">Codici a Barre</h5>
                @if (art.barcodes && art.barcodes.length > 0) {
                  <ul class="list-group list-group-flush">
                    @for (barcode of art.barcodes; track barcode) {
                      <li
                        class="list-group-item d-flex justify-content-between">
                        <span>{{ barcode.barcode }}</span>
                        <small class="text-muted">{{ barcode.idTypeArt }}</small>
                      </li>
                    }
                  </ul>
                } @else {
                  <p class="text-muted small">Nessun codice a barre disponibile.</p>
                }
              </div>
            </div>
          </div>

          <div class="col-lg-4">
            <!-- Action Buttons - Card -->
            <div class="card bg-light mb-4">
              <div class="card-header">Azioni</div>
              <div class="card-body d-grid gap-2">
                <button class="btn btn-warning" (click)="goToEdit()">
                  <i class="bi bi-pencil-square"></i> Modifica Articolo
                </button>
                <button class="btn btn-danger"
                  (click)="onDelete()">
                  <i class="bi bi-trash"></i> Elimina Articolo
                </button>
                <button class="btn btn-outline-secondary" [routerLink]="['/articles']">
                  Torna alla Lista
                </button>
              </div>
            </div>

            <!-- Ingredients - Card -->
            <div class="card shadow-sm h-auto">
              <div class="card-header">Ingredienti</div>
              <div class="card-body">
                @if (art.ingredients?.info; as ingredientsInfo) {
                  <p>
                    {{ ingredientsInfo }}
                  </p>
                } @else {
                  <p class="text-muted small">Nessuna informazione sugli ingredienti disponibile.</p>
                }
              </div>
            </div>
          </div>
        </div>
      }
    }
  </div>

